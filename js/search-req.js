!function(){function e(){const e=new URLSearchParams(window.location.search);const t={};for(const[n,r]of e.entries())t[n]=r;return t}function t(){const t="https://api-edge-sakiko-dispatch-network-aws-cdn.dahi.edu.eu.org/efa18acc-c5b8-480d-bf3f-ee419de809e3";const n=e();delete n.locale;const r=Object.keys(n).map(e=>`${encodeURIComponent(e)}=${encodeURIComponent(n[e])}`).join("&");return r?`${t}?${r}`:t}function n(){const n=t();const r=document.getElementById("script-results");try{r.innerHTML='<div class="loading">載入的結果將在此展示...</div>',fetch(n).then(e=>{if(!e.ok)throw new Error(`API錯誤: ${e.status}`);return e.json()}).then(e=>{o(e),a()}).catch(e=>{r.innerHTML=`<div class="error">載入錯誤: ${e.message}</div>`,console.error("Error fetching scripts:",e)})}catch(e){r.innerHTML=`<div class="error">載入錯誤: ${e.message}</div>`,console.error("Error fetching scripts:",e)}}function o(e){const t=document.getElementById("script-results");if(!t)return;if(!e||0===e.length)return t.innerHTML='<div class="loading">未找到匹配內容</div>',void console.log("No scripts found");let n="";e.forEach(e=>{const o=e.created_at?new Date(e.created_at):null,r=e.code_updated_at?new Date(e.code_updated_at):null;n+=`<li><article><h2><a class="script-link" href="${e.url||"#"}" target="_blank">${e.name||"未命名"}</a><span class="badge badge-js" title="用户脚本">JS</span><span class="name-description-separator">-</span><span class="script-description description">${e.description||"暂无描述"}</span></h2><div class="script-meta-block"><dl class="inline-script-stats"><dt class="script-list-author"><span>作者</span></dt><dd class="script-list-author"><span><a href="${e.users?.[0]?.url||"#"}">${e.users?.[0]?.name||"未知作者"}</a></span></dd><dt class="script-list-daily-installs"><span>日安装量</span></dt><dd class="script-list-daily-installs"><span>${e.daily_installs||0}</span></dd><dt class="script-list-total-installs"><span>总安装量</span></dt><dd class="script-list-total-installs"><span>${e.total_installs||0}</span></dd><dt class="script-list-ratings"><span>评分</span></dt><dd class="script-list-ratings" data-rating-score="${e.fan_score||0}"><span><span class="good-rating-count" title="评级为好评或已加入到收藏的人数">${e.good_ratings||0}</span><span class="ok-rating-count" title="评级为一般的人数">${e.ok_ratings||0}</span><span class="bad-rating-count" title="评级为差评的人数">${e.bad_ratings||0}</span></span></dd><dt class="script-list-created-date"><span>创建于</span></dt><dd class="script-list-created-date"><span>${o?o.toLocaleDateString():"未知"}</span></dd><dt class="script-list-updated-date"><span>更新于</span></dt><dd class="script-list-updated-date"><span>${r?r.toLocaleDateString():"未知"}</span></dd><a href="${e.code_url||"#"}" target="_blank">立即安装此脚本</a></dl></div></article></li>`}),t.outerHTML=n}function r(e){e.preventDefault();const t=document.getElementById("search-submit"),n=t.value,o=new URL(window.location);n?o.searchParams.set("q",n):o.searchParams.delete("q"),window.history.pushState({},"",o),n()}function a(){const t=new URLSearchParams(window.location.search);const n=parseInt(t.get("page")||"1");const r=Math.max(n-1,1);const a=n+1;const c=document.getElementById("pagination");if(c){let e="";e+=`<a href="?${new URLSearchParams({...Object.fromEntries(t.entries()),page:r})}" ${1===n?'style="visibility:hidden"':""}>上一页</a>`;e+=`<span class="current">${n}</span>`;e+=`<a href="?${new URLSearchParams({...Object.fromEntries(t.entries()),page:a})}">下一页</a>`;c.innerHTML=e}}document.getElementById("search-form")?.addEventListener("submit",r),window.addEventListener("popstate",function(){n()}),document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll("[data-sort], [data-site], [data-language]").forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();const t=new URL(window.location);this.dataset.sort&&t.searchParams.set("sort",this.dataset.sort),this.dataset.site&&t.searchParams.set("site",this.dataset.site),this.dataset.language&&t.searchParams.set("language",this.dataset.language),window.history.pushState({},"",t),n()})}),n()})}();document.addEventListener("DOMContentLoaded",function(){const e=new URLSearchParams(window.location.search);let t=e.get("q")||"",n=e.get("sort")||"",o=e.get("filter_locale")||"0",s=e.get("site")||"";const c=document.querySelector('.sidebar-search input[name="q"]');c&&(c.value=t);const d=[{value:"",text:"相关程度"},{value:"daily_installs",text:"日安装量"},{value:"total_installs",text:"总安装量"},{value:"ratings",text:"得分"},{value:"created",text:"创建日期"},{value:"updated",text:"更新日期"},{value:"name",text:"名称"}],a=document.getElementById("sort-options-list");function i(e){return`https://home.greasyfork.org.cn/s?${new URLSearchParams(e).toString()}`}function r(){a.innerHTML="",d.forEach(e=>{const d=document.createElement("li");d.className="list-option",e.value===n&&d.classList.add("list-current");const c=document.createElement("a"),l={q:t,sort:e.value,filter_locale:o};s&&(l.site=s);l.q||delete l.q,c.href=i(l),c.target="_blank",c.textContent=e.text,d.appendChild(c),a.appendChild(d)})}r();const l=document.querySelector(".sidebar-search");l&&l.addEventListener("submit",function(e){e.preventDefault();const a=c.value.trim(),d={q:a,sort:n,filter_locale:o};s&&(d.site=s);d.q||delete d.q;const u=new URL(window.location.href);u.search=new URLSearchParams(d).toString();window.open(u.toString(),"_blank")})});
