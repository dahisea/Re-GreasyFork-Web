<!doctype html><html lang="zh-SG"><head><meta charset="utf-8"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta http-equiv="content-language" content="zh-SG"><meta name="viewport" content="width=device-width,initial-scale=1"><title>內容檢索頁</title><meta name="description" content="查內容"><meta name="keywords" content="轻插件,开发,下载加速,代理加速"><meta name="language" content="zh-SG"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="manifest" href="/site.webmanifest"><link rel="stylesheet" href="https://cdn.jsdmirror.com/gh/greasyfork-proxy/re-gfork-web@main/css/main.css" media="screen"><link rel="stylesheet" href="https://cdn.jsdmirror.com/gh/greasyfork-proxy/re-gfork-web@main/css/mater.css"><link rel="preconnect" href="https://api-edge-sakiko-dispatch-network-aws-cdn.dahi.edu.eu.org"><link rel="preconnect" href="https://gfork.zh-tw.eu.org"><link rel="preconnect" href="https://static-sg-apse1-primary-mirror-aws-s3-cloudfront-public-cdn.dahi.edu.eu.org"><link rel="preconnect" href="https://cdn.greasyfork.org.cn"><script async src="https://cdn.jsdmirror.com/gh/greasyfork-proxy/re-gfork-web@main/js/main.js" crossorigin="anonymous"></script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3758644447684310" crossorigin="anonymous"></script><script>!function() {
    function getHashParams() {
        const hash = window.location.hash;
        const queryString = hash.startsWith('#?') ? hash.substring(2) : '';
        const params = new URLSearchParams(queryString);
        const result = {};
        for (const [key, value] of params.entries()) {
            result[key] = value;
        }
        return result;
    }

    function updatePageTitle() {
        const params = getHashParams();
        const searchQuery = params.q || "";
        const defaultTitle = "內容檢索頁";
        document.title = searchQuery ? `${searchQuery} - ${defaultTitle}` : defaultTitle;
    }

    function buildApiUrl() {
        const baseUrl = "https://api-edge-sakiko-dispatch-network-aws-cdn.dahi.edu.eu.org/efa18acc-c5b8-480d-bf3f-ee419de809e3";
        const params = getHashParams();
        delete params.locale;
        const queryString = Object.keys(params).map(key => 
            `${encodeURIComponent(key)}=${encodeURIComponent(params[key])}`
        ).join("&");
        return queryString ? `${baseUrl}?${queryString}` : baseUrl;
    }

    function loadResults() {
        updatePageTitle();
        const apiUrl = buildApiUrl();
        const resultsContainer = document.getElementById("script-results");
        
        if (!resultsContainer) {
            console.error("Results container not found");
            return;
        }
        
        console.log("Fetching from URL:", apiUrl); // Debug log
        
        try {
            resultsContainer.innerHTML = '<div class="loading">載入的結果將在此展示...</div>';
            
            // Try different fetch configurations to handle CORS
            const fetchOptions = {
                method: 'GET',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                // Add CORS mode - try 'cors' first, fallback to 'no-cors' if needed
                mode: 'cors'
            };
            
            fetch(apiUrl, fetchOptions)
                .then(response => {
                    console.log("Response status:", response.status);
                    console.log("Response headers:", response.headers);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    
                    // Check if response is JSON
                    const contentType = response.headers.get('content-type');
                    if (!contentType || !contentType.includes('application/json')) {
                        throw new Error('Response is not JSON format');
                    }
                    
                    return response.json();
                })
                .then(data => {
                    console.log("API Response:", data); // Debug log
                    renderResults(data);
                    updatePagination();
                })
                .catch(error => {
                    console.error("Fetch error details:", error);
                    
                    // Provide more specific error messages
                    let errorMessage = "載入錯誤: ";
                    if (error.name === 'TypeError' && error.message.includes('fetch')) {
                        errorMessage += "網絡連接失敗或CORS錯誤。請檢查網絡連接。";
                    } else if (error.message.includes('CORS')) {
                        errorMessage += "跨域請求被阻止。API服務器需要設置CORS頭部。";
                    } else if (error.message.includes('JSON')) {
                        errorMessage += "API返回的數據格式無效。";
                    } else {
                        errorMessage += error.message;
                    }
                    
                    resultsContainer.innerHTML = `<div class="error">${errorMessage}</div>`;
                    
                    // Try alternative approach with no-cors mode
                    tryNoCorsRequest(apiUrl, resultsContainer);
                });
        } catch (error) {
            console.error("Unexpected error:", error);
            resultsContainer.innerHTML = `<div class="error">載入錯誤: ${error.message}</div>`;
        }
    }
    
    function tryNoCorsRequest(apiUrl, resultsContainer) {
        console.log("Trying no-cors mode as fallback...");
        
        fetch(apiUrl, { 
            method: 'GET',
            mode: 'no-cors' 
        })
        .then(response => {
            // With no-cors mode, we can't read the response body
            // This is just to test if the request goes through
            console.log("No-cors request completed, but cannot read response");
            resultsContainer.innerHTML = `
                <div class="error">
                    <p>CORS錯誤：無法直接訪問API。</p>
                    <p>可能的解決方案：</p>
                    <ul>
                        <li>聯系API提供方添加CORS支持</li>
                        <li>使用代理服務器</li>
                        <li>在服務器端調用API</li>
                    </ul>
                    <p>API URL: ${apiUrl}</p>
                </div>
            `;
        })
        .catch(error => {
            console.error("No-cors fallback also failed:", error);
            resultsContainer.innerHTML = `
                <div class="error">
                    <p>API請求完全失敗。</p>
                    <p>錯誤信息: ${error.message}</p>
                    <p>API URL: ${apiUrl}</p>
                    <p>請檢查：</p>
                    <ul>
                        <li>網絡連接是否正常</li>
                        <li>API URL是否正確</li>
                        <li>API服務器是否運行正常</li>
                    </ul>
                </div>
            `;
        });
    }

    function renderResults(data) {
        const container = document.getElementById("script-results");
        if (!container) return;
        
        if (!data || data.length === 0) {
            container.innerHTML = '<div class="loading">未找到匹配內容</div>';
            console.log("No scripts found");
            return;
        }

        let html = "";
        data.forEach(item => {
            const createdDate = item.created_at ? new Date(item.created_at) : null;
            const updatedDate = item.code_updated_at ? new Date(item.code_updated_at) : null;
            
            html += `
                <li>
                    <article>
                        <h2>
                            <a class="script-link" href="${item.url || "#"}" target="_blank">${item.name || "未命名"}</a>
                            <span class="badge badge-js" title="用户脚本">JS</span>
                            <span class="name-description-separator">-</span>
                            <span class="script-description description">${item.description || "暂无描述"}</span>
                        </h2>
                        <div class="script-meta-block">
                            <dl class="inline-script-stats">
                                <dt class="script-list-author"><span>作者</span></dt>
                                <dd class="script-list-author"><span><a href="${item.users?.[0]?.url || "#"}">${item.users?.[0]?.name || "未知作者"}</a></span></dd>
                                <dt class="script-list-daily-installs"><span>日安装量</span></dt>
                                <dd class="script-list-daily-installs"><span>${item.daily_installs || 0}</span></dd>
                                <dt class="script-list-total-installs"><span>总安装量</span></dt>
                                <dd class="script-list-total-installs"><span>${item.total_installs || 0}</span></dd>
                                <dt class="script-list-ratings"><span>评分</span></dt>
                                <dd class="script-list-ratings" data-rating-score="${item.fan_score || 0}">
                                    <span>
                                        <span class="good-rating-count" title="评级为好评或已加入到收藏的人数">${item.good_ratings || 0}</span>
                                        <span class="ok-rating-count" title="评级为一般的人数">${item.ok_ratings || 0}</span>
                                        <span class="bad-rating-count" title="评级为差评的人数">${item.bad_ratings || 0}</span>
                                    </span>
                                </dd>
                                <dt class="script-list-created-date"><span>创建于</span></dt>
                                <dd class="script-list-created-date"><span>${createdDate ? createdDate.toLocaleDateString() : "未知"}</span></dd>
                                <dt class="script-list-updated-date"><span>更新于</span></dt>
                                <dd class="script-list-updated-date"><span>${updatedDate ? updatedDate.toLocaleDateString() : "未知"}</span></dd>
                                <a href="${item.code_url || "#"}" target="_blank">立即安装此脚本</a>
                            </dl>
                        </div>
                    </article>
                </li>`;
        });
        
        container.innerHTML = `<ul>${html}</ul>`;
    }

    function handleSearchSubmit(event) {
        event.preventDefault();
        const searchInput = document.getElementById("search-submit");
        if (!searchInput) {
            console.error("Search input not found");
            return;
        }
        
        const query = searchInput.value.trim();
        const url = new URL(window.location);
        url.hash = query ? `#?q=${encodeURIComponent(query)}` : "#";
        window.history.pushState({}, "", url);
        loadResults();
    }

    function updatePagination() {
        const hashParams = window.location.hash.substring(2);
        if (!hashParams) return;
        
        const params = new URLSearchParams(hashParams);
        const currentPage = parseInt(params.get("page") || "1");
        const prevPage = Math.max(currentPage - 1, 1);
        const nextPage = currentPage + 1;
        const paginationContainer = document.getElementById("pagination");
        
        if (paginationContainer) {
            const prevParams = new URLSearchParams(params);
            const nextParams = new URLSearchParams(params);
            
            prevParams.set("page", prevPage.toString());
            nextParams.set("page", nextPage.toString());
            
            let html = "";
            html += `<a href="#?${prevParams.toString()}" ${currentPage === 1 ? 'style="visibility:hidden"' : ""}>上一页</a>`;
            html += `<span class="current">${currentPage}</span>`;
            html += `<a href="#?${nextParams.toString()}">下一页</a>`;
            paginationContainer.innerHTML = html;
        }
    }

    function initializeFormHandlers() {
        // Handle main search form
        const searchForm = document.getElementById("search-form");
        if (searchForm) {
            searchForm.addEventListener("submit", handleSearchSubmit);
        }

        // Handle sidebar search form
        const sidebarSearch = document.querySelector(".sidebar-search");
        if (sidebarSearch) {
            sidebarSearch.addEventListener("submit", function(event) {
                event.preventDefault();
                const searchInput = sidebarSearch.querySelector('input[name="q"]');
                if (!searchInput) return;
                
                const params = getHashParams();
                const searchParams = {
                    q: searchInput.value.trim(),
                    sort: params.sort || "",
                    filter_locale: params.filter_locale || "0"
                };
                
                if (params.site) {
                    searchParams.site = params.site;
                }
                
                // Remove empty parameters
                Object.keys(searchParams).forEach(key => {
                    if (!searchParams[key]) {
                        delete searchParams[key];
                    }
                });
                
                const url = new URL(window.location.href);
                url.hash = `#?${new URLSearchParams(searchParams).toString()}`;
                window.history.pushState({}, "", url);
                
                // Update sort selection after search
                updateSortSelection(searchParams.sort || "");
                
                loadResults();
            });
        }
    }

    function testApiConnection() {
        const baseUrl = "https://api-edge-sakiko-dispatch-network-aws-cdn.dahi.edu.eu.org/efa18acc-c5b8-480d-bf3f-ee419de809e3";
        
        console.log("Testing API connection...");
        console.log("Base URL:", baseUrl);
        
        // Test simple GET request
        fetch(baseUrl, {
            method: 'GET',
            headers: {
                'Accept': 'application/json'
            }
        })
        .then(response => {
            console.log("API Test - Status:", response.status);
            console.log("API Test - Status Text:", response.statusText);
            console.log("API Test - Headers:", [...response.headers.entries()]);
            
            return response.text(); // Try text first to see raw response
        })
        .then(data => {
            console.log("API Test - Raw Response:", data);
            
            // Try to parse as JSON
            try {
                const jsonData = JSON.parse(data);
                console.log("API Test - Parsed JSON:", jsonData);
            } catch (e) {
                console.log("API Test - Response is not valid JSON");
            }
        })
        .catch(error => {
            console.error("API Test - Error:", error);
            console.error("API Test - Error type:", error.constructor.name);
        });
    }

    function updateSortSelection(selectedSort) {
        const sortOptionsList = document.getElementById("sort-options-list");
        if (!sortOptionsList) return;
        
        // Remove current selection from all items
        const allOptions = sortOptionsList.querySelectorAll('.list-option');
        allOptions.forEach(item => {
            item.classList.remove('list-current');
        });
        
        // Add current selection to the clicked item
        allOptions.forEach(item => {
            const link = item.querySelector('a');
            if (link) {
                const url = new URL(link.href, window.location.origin);
                const params = new URLSearchParams(url.hash.substring(2));
                const sortValue = params.get('sort') || '';
                
                if (sortValue === selectedSort) {
                    item.classList.add('list-current');
                }
            }
        });
    }

    function initializePage() {
        const params = getHashParams();
        const query = params.q || "";
        const sort = params.sort || "";
        const filterLocale = params.filter_locale || "0";
        const site = params.site || "";

        // Initialize search input
        const searchInput = document.querySelector('.sidebar-search input[name="q"]');
        if (searchInput) {
            searchInput.value = query;
        }

        // Initialize sort options
        const sortOptions = [
            {value: "", text: "相关程度"},
            {value: "daily_installs", text: "日安装量"},
            {value: "total_installs", text: "总安装量"},
            {value: "ratings", text: "得分"},
            {value: "created", text: "创建日期"},
            {value: "updated", text: "更新日期"},
            {value: "name", text: "名称"}
        ];
        
        const sortOptionsList = document.getElementById("sort-options-list");
        if (sortOptionsList) {
            sortOptionsList.innerHTML = "";
            sortOptions.forEach(option => {
                const listItem = document.createElement("li");
                listItem.className = "list-option";
                if (option.value === sort) {
                    listItem.classList.add("list-current");
                }

                const link = document.createElement("a");
                const queryParams = {
                    q: query,
                    sort: option.value,
                    filter_locale: filterLocale
                };
                
                if (site) {
                    queryParams.site = site;
                }
                
                // Remove empty parameters
                Object.keys(queryParams).forEach(key => {
                    if (!queryParams[key]) {
                        delete queryParams[key];
                    }
                });
                
                link.href = `#?${new URLSearchParams(queryParams).toString()}`;
                link.textContent = option.text;
                
                // Add click handler to update current page
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Update current selection immediately
                    updateSortSelection(option.value);
                    
                    window.history.pushState({}, "", this.href);
                    loadResults();
                });
                
                listItem.appendChild(link);
                sortOptionsList.appendChild(listItem);
            });
            
            // Ensure current selection is properly set after DOM creation
            setTimeout(() => updateSortSelection(sort), 0);
        }
    }

    // Initialize event listeners
    window.addEventListener("popstate", function() {
        // Update sort selection when browser back/forward is used
        const params = getHashParams();
        const currentSort = params.sort || "";
        updateSortSelection(currentSort);
        
        loadResults();
    });

    // Wait for DOM to be ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function() {
            initializeFormHandlers();
            initializePage();
            
            // Test API connection first
            testApiConnection();
            
            loadResults();
        });
    } else {
        initializeFormHandlers();
        initializePage();
        
        // Test API connection first
        testApiConnection();
        
        loadResults();
    }
}();
   </script><style>.loading{text-align:center;color:#666}</style><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f)})(window,document,'script','dataLayer','GTM-KZFGTVN7');</script></head><body><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KZFGTVN7" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><header id="main-header"><div class="width-constraint"><div id="site-name"><div id="site-name-text"><a href="/zh-hans"><h1>GFork</h1></a></div></div><div id="site-nav"><nav><li class="help-link"><a href="/zh-hans/help">帮助</a></li><li class="with-submenu"><a href="#" onclick="return false">更多</a><nav><li><a href="/zh-hans/search">高级搜索</a></li></nav></li></nav></div><div id="mobile-nav"><div class="mobile-nav-opener">☰</div><nav class="collapsed"><li class="help-link"><a href="/zh-hans/help">帮助</a></li><li><a href="/zh-hans/search">高级搜索</a></li></nav></div></div></header><div class="open-sidebar sidebar-collapsed">☰</div><div class="width-constraint"><div class="sidebarred"><div class="sidebarred-main-content"><ol id="browse-script-list" class="script-list"><div id="script-results" class="loading">等待加载脚本中...</div></ol></div><div class="sidebar collapsed"><div class="close-sidebar"><div class="sidebar-title">搜索选项</div><div>☰</div></div><div id="script-list-option-groups" class="list-option-groups"><form class="sidebar-search"><input type="search" name="q" placeholder="搜索脚本"><input class="search-submit" type="submit" value="搜索关键词"></form><div id="script-list-sort" class="list-option-group">脚本排序：<ul id="sort-options-list"></ul></div></div><br><ins class="adsbygoogle" style="display:inline-block;width:190px;height:570px" data-ad-client="ca-pub-3758644447684310" data-ad-slot="4497590737"></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({});</script><br></div></div></div><footer style="font-size:11px;text-align:center"><div id="pagination" class="pagination"></div></footer><ins class="adsbygoogle" style="display:block" data-ad-format="autorelaxed" data-ad-client="ca-pub-3758644447684310" data-ad-slot="3934604756"></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({});</script></body></html>